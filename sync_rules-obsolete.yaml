# PowerSync Sync Rules
# This file defines which data is synced to which users
#
# Note: We use SELECT * for tables where all columns are synced without transformation.
# Tables requiring column aliasing (currencies, user_preferences) use explicit column lists.

bucket_definitions:
  # Global data accessible to all authenticated users
  global:
    data:
      # Currencies: requires aliasing 'code' as 'id' for PowerSync compatibility
      - SELECT code as id, code FROM currencies
      # Exchange rates: all columns synced as-is
      - SELECT * FROM exchange_rates

  # User-specific data
  user_data:
    parameters: SELECT request.user_id() as user_id
    data:
      # User preferences: requires aliasing 'user_id' as 'id' for PowerSync compatibility
      - |
        SELECT
          user_id as id,
          user_id,
          default_currency,
          first_weekday,
          locale,
          created_at,
          updated_at
        FROM user_preferences
        WHERE user_id = bucket.user_id

      # User's categories
      - SELECT * FROM categories WHERE user_id = bucket.user_id

      # User's budgets
      - SELECT * FROM budgets WHERE user_id = bucket.user_id

      # User's accounts
      - SELECT * FROM accounts WHERE user_id = bucket.user_id

      # User's events (cross-category spending tracking)
      - SELECT * FROM events WHERE user_id = bucket.user_id

      # User's transactions
      - SELECT * FROM transactions WHERE user_id = bucket.user_id

      # User's attachments
      - SELECT * FROM attachments WHERE user_id = bucket.user_id

      # Transaction attachments
      - SELECT * FROM transaction_attachments WHERE user_id = bucket.user_id
